# 子弹系统功能说明

## 概述

根据用户要求，实现了完整的子弹系统：

1. **枪械子弹有限**：手枪有子弹数量限制
2. **补给图标换成bullet**：补给图标使用子弹图像
3. **枪械子弹共用一套补给系统**：所有枪械武器共享同一个子弹补给系统

## 详细功能

### 1. 手枪子弹系统

#### 子弹属性
- **初始子弹**：30发
- **最大子弹**：30发
- **武器类型**：远程武器（`is_melee = False`）

#### 子弹消耗
- 每次射击消耗1发子弹
- 子弹用完时无法射击
- 控制台会显示"没有子弹了！"提示

#### 代码实现
```python
# 子弹系统
self.ammo = 30  # 初始子弹数量
self.max_ammo = 30  # 最大子弹数量
self.is_melee = False  # 标记为远程武器

def _perform_attack(self, direction_x, direction_y):
    # 检查子弹数量
    if self.ammo <= 0:
        print("没有子弹了！")
        return
    
    # 创建子弹
    self._create_bullet(direction_x, direction_y)
    
    # 消耗子弹
    self.ammo -= 1
```

### 2. 弹药补给系统

#### 补给图标
- **图像文件**：`assets/images/weapons/bullet_8x8.png`
- **备用颜色**：黄色（如果图像加载失败）
- **大小**：8x8像素

#### 补给属性
- **补给数量**：每次补给10发子弹
- **存活时间**：20秒
- **拾取范围**：30像素

#### 补给逻辑
```python
def on_pickup(self, player):
    # 给玩家的远程武器补充弹药
    for weapon in player.weapon_manager.weapons:
        if hasattr(weapon, 'ammo') and not weapon.is_melee:
            # 确保不超过最大弹药量
            weapon.ammo = min(weapon.ammo + self.ammo_amount, weapon.max_ammo)
            print(f"获得弹药补给！武器类型: {weapon.type}, 当前弹药: {weapon.ammo}/{weapon.max_ammo}")
```

### 3. 补给视觉效果

#### 动画效果
- **浮动动画**：补给物品上下浮动
- **闪烁效果**：最后10秒开始闪烁
- **自动销毁**：20秒后自动消失

#### 渲染逻辑
```python
# 应用浮动效果
bob_offset = math.sin(self.bob_timer) * self.bob_amount
screen_y += int(bob_offset)

# 闪烁效果（最后10秒开始闪烁）
if self.spawn_timer >= self.lifetime - 10.0:
    self.blink_timer += dt
    if self.blink_timer >= self.blink_speed:
        self.visible = not self.visible
```

## 使用方法

### 1. 射击
- **触发方式**：鼠标左键
- **消耗子弹**：每次射击消耗1发
- **子弹不足**：子弹用完时无法射击

### 2. 补给
- **拾取方式**：接触补给物品
- **补给数量**：每次补给10发
- **最大限制**：不超过最大弹药量

### 3. 状态显示
- **武器信息**：显示当前子弹数量
- **补给信息**：显示剩余补给数量
- **控制台提示**：显示补给和消耗信息

## 测试验证

### 运行测试脚本
```bash
python test_ammo_system.py
```

### 测试功能
1. **射击消耗**：左键射击，观察子弹数量减少
2. **补给拾取**：接触黄色子弹补给，观察子弹数量增加
3. **子弹限制**：子弹用完时无法射击
4. **最大限制**：补给不会超过最大弹药量

## 技术细节

### 文件修改清单

1. **`src/modules/weapons/types/bullet.py`**：
   - 添加子弹系统属性
   - 修改攻击逻辑，添加子弹检查
   - 添加子弹消耗机制

2. **`src/modules/items/ammo_supply.py`**：
   - 修改补给图标为子弹图像
   - 更新补给逻辑，支持最大弹药限制
   - 改进补给提示信息

3. **`test_ammo_system.py`**：
   - 新增子弹系统测试脚本
   - 测试射击、补给、限制等功能

### 系统集成

#### 武器管理器
- 支持远程武器识别（`is_melee = False`）
- 自动补给所有远程武器
- 显示武器弹药状态

#### 补给管理器
- 自动生成弹药补给
- 处理补给拾取逻辑
- 管理补给生命周期

## 注意事项

1. **图像资源**：确保 `bullet_8x8.png` 文件存在
2. **子弹平衡**：初始30发子弹，每次补给10发
3. **补给频率**：根据游戏平衡调整补给生成频率
4. **最大弹药**：可以根据武器等级调整最大弹药量

## 未来扩展

1. **多种弹药类型**：可以为不同武器添加不同弹药类型
2. **弹药升级**：通过升级系统增加最大弹药量
3. **特殊弹药**：添加特殊效果弹药（如穿透、爆炸等）
4. **弹药商店**：添加弹药购买系统

## 性能优化

1. **对象池**：使用对象池管理子弹投射物
2. **碰撞优化**：使用空间分区优化碰撞检测
3. **渲染优化**：批量渲染减少绘制调用
4. **内存管理**：及时清理已销毁的投射物 