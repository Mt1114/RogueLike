# 枪械武器功能说明

## 概述

枪械武器是一个远程攻击武器，具有以下特点：
- **初始武器**：现在所有英雄的初始武器都是手枪
- **武器图像**：使用 `gun.png` 作为武器图像
- **子弹投射物**：使用 `bullet_8x8.png` 作为子弹图像
- **左键射击**：鼠标左键触发射击
- **鼠标方向瞄准**：子弹飞行方向跟随鼠标方向
- **快速子弹飞行**：子弹速度提升到600-800
- **武器上抬30度**：射击时武器会自动上抬30度
- **支持穿透多个敌人**

## 功能特性

### 1. 武器动画
- **上抬角度**: 武器会自动上抬30度进行射击
- **旋转动画**: 武器会平滑旋转到目标方向
- **攻击动画**: 射击时显示武器攻击动画

### 2. 子弹系统
- **直线飞行**: 子弹沿直线飞行
- **快速速度**: 子弹飞行速度600-800（比之前更快）
- **生命周期**: 子弹有存活时间限制
- **图像旋转**: 子弹图像会根据飞行方向旋转

### 3. 碰撞检测
- **敌人碰撞**: 子弹与敌人碰撞时造成伤害
- **穿透系统**: 子弹可以穿透多个敌人
- **伤害衰减**: 穿透后伤害会逐渐减少
- **无敌检测**: 不会对处于无敌状态的敌人造成伤害

## 武器配置

### 基础属性
```python
{
    'name': '手枪',
    'icon_path': 'images/weapons/gun.png',
    'max_level': 3
}
```

### 等级配置
- **等级1**: 基础手枪，单发直线射击
  - 伤害: 20
  - 射速: 1.0
  - 子弹速度: 600
  - 穿透: 1个敌人

- **等级2**: 提升伤害和射速
  - 伤害: 25
  - 射速: 1.2
  - 子弹速度: 700
  - 穿透: 2个敌人

- **等级3**: 最高伤害和射速
  - 伤害: 30
  - 射速: 1.5
  - 子弹速度: 800
  - 穿透: 3个敌人

## 使用方法

### 1. 自动获得武器
现在所有英雄在创建时都会自动获得手枪作为初始武器：
```python
player = Player(600, 400, "ninja_frog")  # 自动获得手枪
```

### 2. 左键射击
```python
# 鼠标左键会自动触发射击
# 射击方向跟随鼠标位置
```

### 3. 更新武器
```python
# 在游戏循环中更新
weapon.update(dt)
```

### 4. 渲染武器
```python
# 渲染武器和投射物
weapon.render(screen, camera_x, camera_y)
```

## 技术实现

### 1. 子弹投射物类 (BulletProjectile)
- 继承自 `pygame.sprite.Sprite`
- 支持直线飞行和碰撞检测
- 自动旋转图像以匹配飞行方向
- 支持穿透和伤害衰减

### 2. 子弹武器类 (BulletWeapon)
- 继承自基础 `Weapon` 类
- 实现武器旋转动画
- 管理子弹投射物
- 处理攻击动画
- 实现 `manual_attack` 方法支持左键射击

### 3. 碰撞处理
- 使用距离检测进行快速碰撞
- 支持像素级精确碰撞
- 处理穿透和伤害衰减逻辑

## 文件结构

```
src/modules/weapons/types/
├── bullet.py              # 子弹武器实现
├── fireball.py            # 火球武器（参考）
├── knife.py               # 飞刀武器（参考）
└── frost_nova.py          # 冰锥武器（参考）
```

## 测试

运行测试脚本验证功能：
```bash
python test_gun_weapon.py
```

运行演示脚本：
```bash
python demo_gun_weapon.py
```

测试功能包括：
- 初始武器自动获得手枪
- 左键射击功能
- 鼠标方向瞄准
- 快速子弹飞行
- 武器上抬30度动画
- 敌人碰撞检测
- 穿透系统
- 伤害计算

## 自定义配置

### 修改武器属性
在 `src/modules/weapons/weapons_data.py` 中修改：
```python
'bullet': {
    'name': '手枪',
    'icon_path': 'images/weapons/gun.png',
    'max_level': 3,
    'levels': [
        {
            'level': 1,
            'effects': {
                WeaponStatType.DAMAGE: 25,  # 修改伤害
                WeaponStatType.PROJECTILE_SPEED: 700,  # 修改子弹速度
                WeaponStatType.PENETRATION: 2,  # 修改穿透数量
            }
        }
    ]
}
```

### 修改武器行为
在 `src/modules/weapons/types/bullet.py` 中修改：
```python
# 修改上抬角度
self.target_rotation = base_angle + 45  # 改为45度

# 修改旋转速度
self.rotation_speed = 360  # 改为360度/秒

# 修改攻击动画持续时间
self.attack_animation_duration = 0.3  # 改为0.3秒
```

## 注意事项

1. **图像资源**: 确保 `gun.png` 和 `bullet_8x8.png` 文件存在
2. **性能考虑**: 大量子弹可能影响性能
3. **碰撞检测**: 使用距离检测优化性能
4. **内存管理**: 及时清理已销毁的投射物
5. **初始武器**: 所有英雄现在都使用手枪作为初始武器

## 故障排除

### 子弹不显示
- 检查图像文件路径
- 确认资源管理器正确加载图像
- 检查渲染坐标计算

### 武器不旋转
- 检查旋转角度计算
- 确认旋转速度设置
- 验证动画状态更新

### 碰撞不工作
- 检查碰撞检测逻辑
- 确认敌人对象有 `take_damage` 方法
- 验证距离计算正确

### 初始武器不是手枪
- 检查 `hero_config.py` 中的 `starting_weapon` 设置
- 确认所有英雄配置都使用 `"bullet"`
- 验证玩家初始化过程 