# 刀武器功能说明

## 概述

刀武器是一个双模式武器，具有以下特点：
- **武器图像**：使用 `knife_32x32.png` 作为武器图像
- **攻击特效**：使用 `swing02.png` 作为攻击特效
- **双模式攻击**：左键远程投掷，右键近战攻击
- **攻击特效动画**：近战攻击时显示特效动画
- **飞刀动画**：投掷时飞刀有旋转和缩放动画

## 功能特性

### 1. 远程攻击（左键）
- **投掷飞刀**：左键投掷飞刀进行远程攻击
- **飞刀动画**：飞刀有旋转和缩放动画效果
- **直线飞行**：飞刀沿直线飞行
- **碰撞检测**：与敌人碰撞时造成伤害

### 2. 近战攻击（右键）
- **近战攻击**：右键进行近战攻击
- **攻击特效**：显示 `swing02.png` 攻击特效
- **特效动画**：特效有透明度渐变动画
- **范围攻击**：攻击范围内的敌人

### 3. 攻击特效
- **特效图像**：使用 `swing02.png` 作为攻击特效
- **位置计算**：特效显示在玩家前方
- **旋转效果**：特效根据攻击方向旋转
- **透明度动画**：特效从完全不透明到完全透明

## 武器配置

### 基础属性
```python
{
    'name': '飞刀',
    'icon_path': 'images/weapons/knife_32x32.png',
    'max_level': 3
}
```

### 等级配置
- **等级1**: 基础飞刀，单发直线飞行
  - 伤害: 200
  - 射速: 1.0
  - 飞刀速度: 400
  - 穿透: 否

- **等级2**: 同时发射两把飞刀
  - 伤害: 20
  - 射速: 1.1
  - 飞刀速度: 400
  - 飞刀数量: 2
  - 扇形分布: 15度

- **等级3**: 飞刀可以穿透敌人
  - 伤害: 30
  - 射速: 1.25
  - 飞刀速度: 400
  - 飞刀数量: 2
  - 穿透: 是
  - 最大穿透: 10个敌人

## 使用方法

### 1. 添加武器
```python
player.add_weapon('knife')
```

### 2. 远程攻击（左键）
```python
# 鼠标左键会自动触发远程攻击
# 攻击方向跟随鼠标位置
```

### 3. 近战攻击（右键）
```python
# 鼠标右键会自动触发近战攻击
# 攻击方向跟随鼠标位置
```

### 4. 更新武器
```python
# 在游戏循环中更新
weapon.update(dt)
```

### 5. 渲染武器
```python
# 渲染武器和投射物
weapon.render(screen, camera_x, camera_y)
```

## 技术实现

### 1. 飞刀投射物类 (ThrownKnife)
- 继承自 `pygame.sprite.Sprite`
- 支持直线飞行和碰撞检测
- 自动旋转图像以匹配飞行方向
- 投掷动画效果（缩放和旋转）

### 2. 刀武器类 (Knife)
- 继承自基础 `Weapon` 类
- 实现双模式攻击（远程和近战）
- 管理飞刀投射物
- 处理攻击特效动画
- 实现 `manual_attack` 和 `melee_attack` 方法

### 3. 攻击特效
- 加载 `swing02.png` 特效图像
- 根据攻击方向旋转特效
- 透明度渐变动画
- 位置计算（玩家前方）

### 4. 碰撞处理
- 使用距离检测进行快速碰撞
- 支持像素级精确碰撞
- 处理穿透和伤害衰减逻辑

## 文件结构

```
src/modules/weapons/types/
├── knife.py              # 刀武器实现
├── bullet.py             # 子弹武器（远程）
├── fireball.py           # 火球武器（参考）
└── frost_nova.py         # 冰锥武器（参考）
```

## 测试

运行测试脚本验证功能：
```bash
python test_knife_weapon.py
```

运行演示脚本：
```bash
python demo_knife_weapon.py
```

测试功能包括：
- 武器图像加载
- 攻击特效显示
- 左键远程攻击
- 右键近战攻击
- 攻击特效动画
- 飞刀旋转和缩放动画
- 敌人碰撞检测
- 穿透系统
- 伤害计算

## 自定义配置

### 修改武器属性
在 `src/modules/weapons/weapons_data.py` 中修改：
```python
'knife': {
    'name': '飞刀',
    'icon_path': 'images/weapons/knife_32x32.png',
    'max_level': 3,
    'levels': [
        {
            'level': 1,
            'effects': {
                WeaponStatType.DAMAGE: 25,  # 修改伤害
                WeaponStatType.PROJECTILE_SPEED: 500,  # 修改飞刀速度
                WeaponStatType.PROJECTILES_PER_CAST: 2,  # 修改飞刀数量
            }
        }
    ]
}
```

### 修改武器行为
在 `src/modules/weapons/types/knife.py` 中修改：
```python
# 修改攻击特效持续时间
self.melee_attack_duration = 0.5  # 改为0.5秒

# 修改特效距离
effect_distance = 60  # 改为60像素

# 修改攻击范围
attack_range = 100  # 改为100像素
```

## 注意事项

1. **图像资源**: 确保 `knife_32x32.png` 和 `swing02.png` 文件存在
2. **性能考虑**: 大量飞刀可能影响性能
3. **碰撞检测**: 使用距离检测优化性能
4. **内存管理**: 及时清理已销毁的投射物
5. **特效动画**: 攻击特效有透明度渐变

## 故障排除

### 飞刀不显示
- 检查图像文件路径
- 确认资源管理器正确加载图像
- 检查渲染坐标计算

### 攻击特效不显示
- 检查特效文件路径 (`images/attcak/hit_animations/swing02.png`)
- 确认特效图像正确加载
- 验证特效渲染逻辑

### 近战攻击不工作
- 检查右键事件处理
- 确认攻击范围设置
- 验证敌人碰撞检测

### 远程攻击不工作
- 检查左键事件处理
- 确认飞刀投射物创建
- 验证飞刀动画逻辑 