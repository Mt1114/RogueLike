# 光照预设系统使用指南

## 概述

光照系统现在支持多种预设配置，您可以根据不同的游戏场景和需求选择合适的照明效果。

## 可用预设

### 1. 默认视野 (default)
- **视野半径**: 300像素
- **视野角度**: 90°
- **光圈半径**: 150像素
- **黑暗程度**: 200
- **光线数量**: 24
- **适用场景**: 平衡的照明效果，适合大多数游戏场景

### 2. 宽视野 (wide)
- **视野半径**: 400像素
- **视野角度**: 120°
- **光圈半径**: 100像素
- **黑暗程度**: 180
- **光线数量**: 32
- **适用场景**: 需要更广阔的视野，适合探索和战斗

### 3. 窄视野 (narrow)
- **视野半径**: 200像素
- **视野角度**: 60°
- **光圈半径**: 60像素
- **黑暗程度**: 220
- **光线数量**: 16
- **适用场景**: 紧张刺激的场景，视野受限增加挑战性

### 4. 夜视模式 (night_vision)
- **视野半径**: 500像素
- **视野角度**: 180°
- **光圈半径**: 120像素
- **黑暗程度**: 150
- **光线数量**: 36
- **适用场景**: 夜间探索，提供良好的视野但保持黑暗氛围

### 5. 隧道视野 (tunnel)
- **视野半径**: 250像素
- **视野角度**: 45°
- **光圈半径**: 40像素
- **黑暗程度**: 240
- **光线数量**: 12
- **适用场景**: 恐怖游戏或紧张场景，视野极其受限

### 6. 聚光灯 (spotlight)
- **视野半径**: 350像素
- **视野角度**: 30°
- **光圈半径**: 80像素
- **黑暗程度**: 210
- **光线数量**: 18
- **适用场景**: 需要精确瞄准的场景，如狙击或精确攻击

### 7. 泛光灯 (floodlight)
- **视野半径**: 600像素
- **视野角度**: 150°
- **光圈半径**: 200像素
- **黑暗程度**: 160
- **光线数量**: 40
- **适用场景**: 需要大面积照明的场景，如大型战斗或探索

### 8. 最小视野 (minimal)
- **视野半径**: 150像素
- **视野角度**: 45°
- **光圈半径**: 30像素
- **黑暗程度**: 250
- **光线数量**: 12
- **适用场景**: 极限挑战模式，视野最小化

### 9. 明亮模式 (bright)
- **视野半径**: 400像素
- **视野角度**: 90°
- **光圈半径**: 150像素
- **黑暗程度**: 120
- **光线数量**: 28
- **适用场景**: 需要明亮照明的场景，减少黑暗氛围

## 游戏内控制

### 键盘快捷键
- **F3**: 切换光照系统开关
- **F4**: 循环切换光照预设

### 编程接口
```python
# 设置特定预设
game.set_lighting_preset("night_vision")

# 获取可用预设列表
presets = game.get_available_lighting_presets()

# 获取当前预设
current_preset = game.get_current_lighting_preset()
```

## 预设参数说明

### 视野半径 (sector_radius)
- **范围**: 100-1000像素
- **作用**: 控制扇形视野的覆盖范围
- **建议**: 值越大，视野越远，但性能消耗也越大

### 视野角度 (sector_angle)
- **范围**: 30-360度
- **作用**: 控制扇形视野的角度范围
- **建议**: 
  - 30-60°: 精确瞄准
  - 90-120°: 平衡视野
  - 150-180°: 广阔视野

### 光线数量 (ray_count)
- **范围**: 20-56
- **作用**: 控制构成扇形的光线数量，影响扇形的平滑度和抗锯齿效果
- **建议**: 
  - 20-24: 低性能设备，快速渲染
  - 24-32: 平衡性能和效果
  - 32-40: 高质量效果，减少锯齿
  - 40-56: 最高质量，适合大视野，最佳抗锯齿效果

### 光圈半径 (circle_radius)
- **范围**: 10-200像素
- **作用**: 控制玩家周围圆形光圈的半径
- **建议**: 
  - 30-60像素: 紧凑照明
  - 100-150像素: 舒适照明
  - 150-200像素: 明亮照明

### 黑暗程度 (darkness_alpha)
- **范围**: 0-255
- **作用**: 控制全局黑暗的强度
- **建议**: 
  - 0-100: 明亮环境
  - 100-180: 正常黑暗
  - 180-255: 深度黑暗

## 抗锯齿优化

### 抗锯齿技术
系统采用了多种抗锯齿技术来减少光照边缘的锯齿：

1. **增加光线数量**: 从12条增加到20-56条光线
2. **边缘平滑处理**: 在边缘点绘制小圆来平滑边界
3. **多边形填充**: 使用更平滑的多边形绘制方式

### 各预设的抗锯齿效果
- **默认视野**: 32条光线，平衡效果
- **宽视野**: 40条光线，良好抗锯齿
- **窄视野**: 24条光线，紧凑但平滑
- **夜视模式**: 48条光线，最佳抗锯齿
- **隧道视野**: 20条光线，快速渲染
- **聚光灯**: 28条光线，精确抗锯齿
- **泛光灯**: 56条光线，最高质量
- **最小视野**: 20条光线，快速渲染
- **明亮模式**: 36条光线，高质量

## 性能考虑

### 视野半径对性能的影响
- 较小的视野半径 (< 300像素): 高性能
- 中等视野半径 (300-500像素): 平衡性能
- 较大视野半径 (> 500像素): 可能影响性能

### 视野角度对性能的影响
- 较小的视野角度 (< 90°): 高性能
- 中等视野角度 (90-150°): 平衡性能
- 较大的视野角度 (> 150°): 可能影响性能

### 光线数量对性能的影响
- 较少光线 (20-24条): 高性能，适合低端设备
- 中等光线 (24-32条): 平衡性能，推荐设置
- 较多光线 (32-40条): 高质量，适合中高端设备
- 大量光线 (40-56条): 最高质量，适合高端设备

## 自定义预设

您可以在 `src/modules/vision_config.py` 文件中添加自定义预设：

```python
VISION_PRESETS = {
    "my_custom_preset": {
        "name": "我的自定义预设",
        "sector_radius": 350,
        "sector_angle": 75,
        "circle_radius": 100,
        "darkness_alpha": 180,
    },
    # ... 其他预设
}
```

## 测试预设

使用测试脚本可以预览所有预设效果：

```bash
python test_lighting_presets.py
```

测试脚本功能：
- 显示当前预设信息
- 实时切换预设
- 显示预设参数
- 测试墙壁遮挡效果

## 最佳实践

### 游戏场景建议
1. **探索阶段**: 使用 "wide" 或 "night_vision"
2. **战斗阶段**: 使用 "default" 或 "spotlight"
3. **紧张场景**: 使用 "tunnel" 或 "minimal"
4. **大型战斗**: 使用 "floodlight"
5. **精确操作**: 使用 "spotlight"

### 性能优化
1. 避免同时使用大视野半径和大视野角度
2. 在低性能设备上使用 "minimal" 预设
3. 根据游戏场景动态切换预设
4. 监控FPS，必要时降低预设参数

## 故障排除

### 常见问题
1. **预设切换不生效**: 检查预设名称是否正确
2. **性能下降**: 尝试使用较小的视野参数
3. **光照效果异常**: 检查墙壁数据是否正确设置

### 调试信息
光照系统会输出调试信息：
```
已应用光照预设: 夜视模式
光照系统初始化完成，当前预设: default
``` 